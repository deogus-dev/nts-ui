import{h as _}from"./moment-fbc5633a.js";import{r as m,w as M,o as w,a as h,b as y,c as C,d as f,u as I,e as x,f as B,g as r,t as i,h as E,i as T,j as Y,F as D,_ as v}from"./index-3e6c4169.js";const $={id:"map"},H={__name:"kakaoMap",setup(L,{emit:c}){var t,s,d;const l=m([]),a=m({});M(a,()=>{if(t){var e=new kakao.maps.LatLng(a.lat,a.lng);t.setCenter(e),s.setPosition(e),n()}});const u=()=>{navigator.geolocation&&(d=navigator.geolocation.watchPosition(e=>{a.lat=e.coords.latitude,a.lng=e.coords.longitude},e=>{},{enableHighAccuracy:!1}))},n=()=>{l.some(e=>{if(a.lng>e.getBounds().ha&&a.lat>e.getBounds().qa&&a.lng<e.getBounds().oa&&a.lat<e.getBounds().pa)return console.log("in position [ %s ]",e.Eb.fillColor),c("setLocationInfo",{circleIn:!0,locCode:e.Eb.fillColor}),!0;c("setLocationInfo",{circleIn:!1,locCode:null})})},p=async()=>{var e=document.getElementById("map"),g={center:new kakao.maps.LatLng(37.51082,127.02928),level:4};t=new kakao.maps.Map(e,g),s=new kakao.maps.Marker({position:t.getCenter()}),s.setMap(t),f.api({url:"/company-locations",method:"get"}).then(k=>{k.forEach(o=>{l.push(new kakao.maps.Circle({center:new kakao.maps.LatLng(o.latitude,o.longitude),fillColor:o.locationCode}))}),l.forEach(o=>{o.setMap(t)}),n()}),t.setDraggable(!0),kakao.maps.event.addListener(t,"click",k=>{var o=k.latLng;s.setPosition(o),a.lat=o.getLat(),a.lng=o.getLng()})};return w(()=>{if(!window.kakao||!window.kakao.maps){const e=document.createElement("script");e.src="//dapi.kakao.com/v2/maps/sdk.js?autoload=false&appkey=8425cb2bc152a90c5eae2c00e29f04dc",e.addEventListener("load",()=>{kakao.maps.load(p)}),document.head.appendChild(e)}else p()}),h(()=>{navigator.geolocation.clearWatch(d)}),"geolocation"in navigator&&u(),(e,g)=>(y(),C("div",$))}};const b={class:"fw-bold"},A=["disabled"],P={__name:"appMain",setup(L){const c=I(),t=m({}),s=x(_().format("YYYY-MM-DD HH:mm:ss"));let d=setInterval(()=>{s.value=_().format("YYYY-MM-DD HH:mm:ss")},1e3);const l=m({}),a=e=>{v.merge(l,e)},u=()=>{f.api({url:"/attend",method:"get"}).then(e=>{v.merge(t,e)})},n=B(()=>t.inTime&&t.outTime?{key:"end",txt:"근무종료"}:t.inTime?{key:"off",txt:"퇴근"}:{key:"on",txt:"출근"}),p=()=>{f.api({url:`/attend/${n.value.key}`,data:{locationCode:"LC01",attendCode:"AT01"}}).then(()=>{alert(n.value.txt+"이 완료되었습니다."),u()})};return h(()=>{clearInterval(d)}),u(),(e,g)=>(y(),C(D,null,[r("p",null,[r("span",b,i(E(c).getUserNm),1),T("님 환영합니다. ")]),r("p",null,"현재시간 : "+i(s.value),1),r("p",null,"출근시간 : "+i(e.$filters.timeFormat(t.inTime)),1),r("p",null,"퇴근시간 : "+i(e.$filters.timeFormat(t.outTime)),1),r("button",{onClick:p,disabled:n.value.key==="end"||n.value.key==="on"&&!l.circleIn},i(n.value.txt),9,A),Y(H,{onSetLocationInfo:a})],64))}};export{P as default};
